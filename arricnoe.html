<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>Translitera√ß√£o PT ‚Üí Tamil / √Årabe</title>
<style>
body{font-family:Arial,sans-serif;padding:20px;background:#f7f7f7;}
textarea{width:100%;height:100px;font-size:16px;padding:8px;}
button{margin-top:8px;padding:10px 16px;font-size:16px;}
pre{background:#fff;border:1px solid #ddd;padding:12px;border-radius:6px;white-space:pre-wrap;}
.label{font-weight:bold;margin-top:12px;display:inline-block;margin-right:5px;}
.speaker{width:20px;height:20px;cursor:pointer;vertical-align:middle;}
#savedTextsArea div{margin-bottom:5px;padding:5px;border:1px solid #ccc;border-radius:5px;background:#f0f0f0;}
#savedTextsWindow{display:none;position:fixed;top:50px;left:50%;transform:translateX(-50%);width:90%;max-width:500px;height:70%;background:#fff;border:2px solid #000;overflow:auto;padding:10px;z-index:1000;}
#savedTextsWindow h3{margin-top:0;}
#closeSavedWindow{float:right;cursor:pointer;font-weight:bold;}
.audioBtn{cursor:pointer;margin-left:8px;vertical-align:middle;}
</style>
</head>
<body>

<h2>Translitera√ß√£o PT ‚Üí Tamil / √Årabe</h2>
<textarea id="inputText">Carro √© bonito, Jo√£o foi l√°.</textarea><br>

<select id="variantSelect">
  <option value="all">Todos</option>
  <option value="tamilLiteral">Tamil Literal</option>
  <option value="tamilSyllabic">Tamil Sil√°bico</option>
  <option value="arabic">√Årabe</option>
</select>
<button onclick="transliterar()">Transliterar</button>

<div id="resultArea">
  <div id="tamilLiteralDiv" style="display:none">
    <span class="label">Tamil Literal:</span>
    <img src="https://img.icons8.com/material-outlined/24/000000/speaker.png" class="speaker" onclick="speakOnline('tamilLiteral')">
    <pre id="tamilLiteral"></pre>
  </div>

  <div id="tamilSyllabicDiv" style="display:none">
    <span class="label">Tamil Sil√°bico:</span>
    <img src="https://img.icons8.com/material-outlined/24/000000/speaker.png" class="speaker" onclick="speakOnline('tamilSyllabic')">
    <pre id="tamilSyllabic"></pre>
  </div>

  <div id="arabicDiv" style="display:none">
    <span class="label">√Årabe:</span>
    <img src="https://img.icons8.com/material-outlined/24/000000/speaker.png" class="speaker" onclick="speakOnline('arabic')">
    <pre id="arabicOut"></pre>
  </div>
</div>

<h3>Mem√≥ria do Aplicativo</h3>
<button onclick="saveCurrentText()">üíæ Salvar Texto Atual</button>
<button onclick="openSavedWindow()">üìÑ Ver Textos Salvos</button>

<!-- Janela separada de textos salvos -->
<div id="savedTextsWindow">
  <h3>Textos Salvos <span id="closeSavedWindow" onclick="closeSavedWindow()">‚úñ</span></h3>
  <div id="savedTextsArea"></div>
</div>

<script>
/* --- Normaliza√ß√£o --- */
function normalizePT(text){
  return text.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/√ß/g,'ÿ≥');
}

/* --- Mapas --- */
const TAM_LIT = {
  'a':'‡ÆÖ','b':'‡Æ™','c':'‡Æï‡Øç','d':'‡Æü‡Øç','e':'‡Æé','f':'‡ÆÉ‡Æ™','g':'‡Æï‡Øç','h':'‡Æπ','i':'‡Æá','j':'‡Æú',
  'k':'‡Æï‡Øç','l':'‡Æ≤','m':'‡ÆÆ','n':'‡Æ®','o':'‡Æí','p':'‡Æ™','q':'‡Æï‡Øç','r':'‡Æ∞','s':'‡Æ∏','t':'‡Æü‡Øç',
  'u':'‡Æâ','v':'‡Æµ','w':'‡Æµ','x':'‡Æï‡Øç‡Æ∏‡Øç','y':'‡ÆØ','z':'‡Æú',
  ' ':' ','!':'!','.':'.',',':',','?':'?','-':'-'
};
const TAM_BASE = {
  'b':'‡Æ™‡Øç','c':'‡Æï‡Øç','d':'‡Æü‡Øç','f':'‡ÆÉ‡Æ™‡Øç','g':'‡Æï‡Øç','h':'‡Æπ‡Øç','j':'‡Æú‡Øç','k':'‡Æï‡Øç','l':'‡Æ≤‡Øç',
  'm':'‡ÆÆ‡Øç','n':'‡Æ®‡Øç','p':'‡Æ™‡Øç','q':'‡Æï‡Øç','r':'‡Æ∞‡Øç','s':'‡Æ∏‡Øç','t':'‡Æü‡Øç','v':'‡Æµ‡Øç','w':'‡Æµ‡Øç',
  'x':'‡Æï‡Øç‡Æ∏‡Øç','y':'‡ÆØ‡Øç','z':'‡Æú‡Øç','rr':'‡Æ∞‡Øç‡Æ∞‡Øç','ss':'‡Æ∏‡Øç‡Æ∏','nh':'‡Æû‡Øç','ch':'‡Æö‡Øç','lh':'‡Æ≥‡Øç'
};
const TAM_VOW_IND = {'a':'‡ÆÖ','e':'‡Æé','i':'‡Æá','o':'‡Æí','u':'‡Æâ'};
const TAM_VOW_DIAC = {'a':'','e':'‡ØÜ','i':'‡Æø','o':'‡Øä','u':'‡ØÅ'};
const SIL_DG = ['nh','lh','rr','ss','ch'];

const ARAB_MAP = {

  // üîπ Trigramas / sons combinados
  'tra':'ÿ™ÿ±ÿß',
  'tri':'ÿ™ÿ±Ÿä',
  'tre':'ÿ™ÿ±Ÿä',
  'tro':'ÿ™ÿ±Ÿà',
  'tra':'ÿ™ÿ±ÿß',
  'lli':'ŸÑŸä',
  'lha':'ŸÑÿß',
  'nh√£':'ŸÜŸäÿß',
  'nh√°':'ŸÜŸäÿß',
  '√ß√£o':'ÿ≥ÿßŸà',
  '√ß√µes':'ÿ≥ÿßŸàÿ≥',
  'lha':'ŸÑŸäÿß',
  'lho':'ŸÑŸäŸà',
  'lhe':'ŸÑŸäŸä',
  'cha':'ÿ¥ÿß',
  'che':'ÿ¥Ÿä',
  'chi':'ÿ¥Ÿä',
  'cho':'ÿ¥Ÿà',
  'gui':'ÿ∫Ÿä',
  'gue':'ÿ∫Ÿä',
  'g√ºe':'ÿ∫Ÿä',
  'g√£o':'ÿ∫ÿßŸà',
  'rro': 'ÿ≠Ÿà',

  // üîπ Digramas
  'ca':'ŸÉÿß','co':'ŸÉŸà','cu':'ŸÉŸà','ce':'ÿ≥Ÿä','ci':'ÿ≥Ÿä',
  '√ßa':'ÿ≥ÿß','√ß√£':'ÿ≥ÿß','√ß√°':'ÿ≥ÿß','√ßi':'ÿ≥Ÿä','√ß√≠':'ÿ≥Ÿä','√ßo':'ÿ≥Ÿà','√ß√≥':'ÿ≥Ÿà','√ßu':'ÿ≥Ÿà','√ß√∫':'ÿ≥Ÿà','√ß√µ':'ÿ≥Ÿà',
  'nh':'ŸÜ','lh':'ŸÑ',
  'rr':'ÿ±',  // RR aspirado simplificado
  'ss':'ÿ≥',

  // üîπ Letras isoladas
  'a':'ÿß','b':'ÿ®','c':'ŸÉ','√ß':'ÿ≥','d':'ÿØ','e':'Ÿä','f':'ŸÅ','g':'ÿ¨','h':'Ÿá','i':'Ÿä','j':'ÿ¨',
  'k':'ŸÉ','l':'ŸÑ','m':'ŸÖ','n':'ŸÜ','o':'Ÿà','p':'ÿ®','q':'ŸÇ','r':'ÿ±','s':'ÿ≥','t':'ÿ™',
  'u':'Ÿà','v':'ŸÅ','w':'Ÿà','x':'ŸÉÿ≥','y':'Ÿä','z':'ÿ≤',
  ' ':' ','!':'!','.':'.',',':',','?':'ÿü','-':'-'
};


// üîπ Fun√ß√£o para normalizar acentos
function normalizePT(txt) {
  return txt.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
}


// üîπ Fun√ß√£o para ajustar Rs (antes de aplicar ARAB_MAP)
function ajustarRs(texto) {
  return texto.split(/\b/).map(palavra => {
    if (!/^[a-zA-Z]+$/.test(palavra)) return palavra;
    let p = palavra.toLowerCase();

    // RR ‚Üí aspirado forte
    p = p.replace(/rr/g, 'ÿ≠');

    // R no in√≠cio ‚Üí aspirado
    p = p.replace(/^r/g, 'ÿ≠');

    // R antes de consoante forte (k, t, p, q, c)
    p = p.replace(/r(?=[ktpqc])/g, 'ÿ≠');

    // R entre vogais ‚Üí suave
    p = p.replace(/(?<=[aeiou])r(?=[aeiou])/g, 'ÿ±');

    // R no final ‚Üí suave
    p = p.replace(/r$/g, 'ÿ±');

    // Restante (fallback)
    p = p.replace(/r/g, 'ÿ±');

    return p;
  }).join('');
}


// üîπ Fun√ß√£o principal de translitera√ß√£o
function translitArabic(text) {
  const ajustado = ajustarRs(text);
  const s = normalizePT(ajustado);

  // Aplicar substitui√ß√µes compostas (trigramas e digramas)
  let resultado = s;
  const chaves = Object.keys(ARAB_MAP).sort((a, b) => b.length - a.length);
  for (const chave of chaves) {
    const valor = ARAB_MAP[chave];
    resultado = resultado.replaceAll(chave, valor);
  }

  return resultado;
}


};

/* --- Tamil Literal --- */
function translitTamilLiteral(text){
  const s = normalizePT(text.toLowerCase());
  let out='';
  for(let i=0;i<s.length;){
    let matched=false;
    for(const dg of SIL_DG){
      if(s.substr(i,dg.length)===dg){
        for(const ch of dg) out += (TAM_LIT[ch]||ch);
        i+=dg.length; matched=true; break;
      }
    }
    if(matched) continue;
    out += (TAM_LIT[s[i]]||s[i]); i++;
  }
  return out;
}

/* --- Tamil Sil√°bico --- */
function translitTamilSyllabic(text){
  const s = normalizePT(text.toLowerCase());
  const tokens = s.match(/\s+|\S+/g)||[];
  const out = tokens.map(tok=>{
    if(!/[a-z]/.test(tok)) return tok;
    const phon=[];
    for(let i=0;i<tok.length;){
      let found=false;
      for(const dg of SIL_DG){
        if(tok.substr(i,dg.length)===dg){ phon.push(dg); i+=dg.length; found=true; break; }
      }
      if(found) continue;
      phon.push(tok[i]); i++;
    }
    const res=[];
    for(let i=0;i<phon.length;){
      const p=phon[i];
      if(TAM_BASE[p]){
        const next=phon[i+1];
        if(next && ['a','e','i','o','u'].includes(next)){
          const base=TAM_BASE[p].replace(/‡Øç$/,'');
          const diac=TAM_VOW_DIAC[next];
          res.push(base+diac);
          i+=2;
        } else { res.push(TAM_BASE[p]); i++; }
      } else if(['a','e','i','o','u'].includes(p)){ res.push(TAM_VOW_IND[p]||p); i++; }
      else{ res.push(TAM_LIT[p]||p); i++; }
    }
    return res.join('');
  });
  return out.join('');
}

/* --- √Årabe --- */


/* --- Mem√≥ria --- */
let savedTexts = JSON.parse(localStorage.getItem('savedTexts')||'[]');

function saveCurrentText(){
  const variant = document.getElementById('variantSelect').value;
  let txt='';
  if(variant==='tamilLiteral') txt=translitTamilLiteral(document.getElementById('inputText').value);
  else if(variant==='tamilSyllabic') txt=translitTamilSyllabic(document.getElementById('inputText').value);
  else if(variant==='arabic') txt=translitArabic(document.getElementById('inputText').value);
  else txt={
    'tamilLiteral':translitTamilLiteral(document.getElementById('inputText').value),
    'tamilSyllabic':translitTamilSyllabic(document.getElementById('inputText').value),
    'arabic':translitArabic(document.getElementById('inputText').value)
  };
  savedTexts.push(txt);
  localStorage.setItem('savedTexts',JSON.stringify(savedTexts));
  alert('Texto salvo na mem√≥ria do aplicativo!');
}

function openSavedWindow(){
  document.getElementById('savedTextsWindow').style.display='block';
  renderSavedTexts();
}

function closeSavedWindow(){
  document.getElementById('savedTextsWindow').style.display='none';
}

function renderSavedTexts(){
  const area=document.getElementById('savedTextsArea');
  area.innerHTML='';
  savedTexts.forEach((t,i)=>{
    const div=document.createElement('div');
    if(typeof t==='string') div.textContent=t;
    else div.textContent='[Variantes Salvas]';
    const del=document.createElement('button');
    del.textContent='‚ùå Apagar';
    del.onclick=()=>{ savedTexts.splice(i,1); localStorage.setItem('savedTexts',JSON.stringify(savedTexts)); renderSavedTexts();};
    const audio=document.createElement('img');
    audio.src="https://img.icons8.com/material-outlined/24/000000/speaker.png";
    audio.className="audioBtn";
    audio.onclick=()=>{
      if(typeof t==='string') speakTextDirect(t,'pt-BR');
      else{
        if(t.tamilLiteral) speakTextDirect(t.tamilLiteral,'ta-IN');
        if(t.tamilSyllabic) speakTextDirect(t.tamilSyllabic,'ta-IN');
        if(t.arabic) speakTextDirect(t.arabic,'ar-SA');
      }
    };
    div.appendChild(audio);
    div.appendChild(del);
    area.appendChild(div);
  });
}


/* --- √ÅUDIO (substitui√ß√£o m√≠nima) usando Google TTS --- */
function speakOnline(id){
  let text = '';
  let lang = 'pt';
  if(id === 'tamilLiteral' || id === 'tamilSilabic' || id === 'tamilSyllabic'){
    text = (document.getElementById('tamilLiteral') || document.getElementById('tamilSilabic') || document.getElementById('tamilSyllabic')).textContent || '';
    lang = 'ta';
    if(document.getElementById(id)) text = document.getElementById(id).textContent || text;
  } else if(id === 'arabic' || id === 'arabicOut'){
    text = (document.getElementById('arabicOut') || document.getElementById('arabic')).textContent || '';
    lang = 'ar';
  } else {
    const el = document.getElementById(id);
    if(el) text = el.textContent || '';
  }
  text = (text || '').toString().trim();
  if(!text) return;
  const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=${lang}&client=tw-ob`;
  const audio = new Audio(url);
  audio.play().catch(err => console.warn('Erro ao tocar audio:', err));
}

function speakOnlineFromText(text,variant){
  if(!text || !text.toString().trim()) return;
  let lang='pt';
  if(variant==='tamilLiteral' || variant==='tamilSyllabic' || variant==='tamilSilabic') lang='ta';
  if(variant==='arabic' || variant==='arabicOut') lang='ar';
  const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=${lang}&client=tw-ob`;
  const audio = new Audio(url);
  audio.play().catch(err => console.warn('Erro ao tocar audio salvo:', err));
}


/* --- Transliterate com seletor --- */
function transliterar(){
  const txt=document.getElementById('inputText').value||'';
  const variant=document.getElementById('variantSelect').value;
  if(variant==='tamilLiteral'){
    document.getElementById('tamilLiteralDiv').style.display='block';
    document.getElementById('tamilLiteral').textContent=translitTamilLiteral(txt);
    document.getElementById('tamilSyllabicDiv').style.display='none';
    document.getElementById('arabicDiv').style.display='none';
  } else if(variant==='tamilSyllabic'){
    document.getElementById('tamilSyllabicDiv').style.display='block';
    document.getElementById('tamilSyllabic').textContent=translitTamilSyllabic(txt);
    document.getElementById('tamilLiteralDiv').style.display='none';
    document.getElementById('arabicDiv').style.display='none';
  } else if(variant==='arabic'){
    document.getElementById('arabicDiv').style.display='block';
    document.getElementById('arabicOut').textContent=translitArabic(txt);
    document.getElementById('tamilLiteralDiv').style.display='none';
    document.getElementById('tamilSyllabicDiv').style.display='none';
  } else {
    document.getElementById('tamilLiteralDiv').style.display='block';
    document.getElementById('tamilLiteral').textContent=translitTamilLiteral(txt);
    document.getElementById('tamilSyllabicDiv').style.display='block';
    document.getElementById('tamilSyllabic').textContent=translitTamilSyllabic(txt);
    document.getElementById('arabicDiv').style.display='block';
    document.getElementById('arabicOut').textContent=translitArabic(txt);
  }
}


/* --- Inicializa√ß√£o --- */
document.addEventListener('DOMContentLoaded',()=>{ transliterar(); });
</script>
</body>
</html>
